{%- macro runbook(obj) -%}
# THIS FILE IS AUTOMATICALLY GENERATED.
# Disclaimer: Please test this file before using in production.
import os
import json
from calm.dsl.runbooks import *
from calm.dsl.runbooks import CalmEndpoint as Endpoint, RunbookTask as CalmTask, RunbookVariable as CalmVariable
from calm.dsl.builtins import CalmTask as CalmVarTask{% if obj.project_name %}, Metadata{%- endif %}

{%- if obj.endpoints %}
# Endpoints
{%- for endpoint in obj.endpoints %}
{{endpoint}}
{%- endfor %}
{% endif %}

{% if obj.secret_files %}
# Secret Variables
{%- endif %}
{%- for var_file in obj.secret_files %}
{{var_file}} = read_local_file('{{var_file}}')
{%- endfor %}

{% if obj.credentials %}
# Credentials
{%- endif %}
{%- for cred in obj.credentials %}
{{cred}}
{%- endfor %}

# Runbook
@runbook
def {{obj.name}}(
    {% if obj.credentials_list %}credentials={{obj.credentials_list | replace("'","")}}{% endif %}
    {% if obj.default_endpoint_name %}{% if obj.credentials_list %},{% endif %}default=ref({{obj.default_endpoint_name | replace("'","")}}){% endif %}
    {% if obj.execution_name %}{% if obj.credentials_list or obj.default_endpoint_name %},{% endif %}execution_name="{{ obj.execution_name | replace('"', '\\"') }}"{% endif %}
):
{% if obj.description %}
    """{{obj.description}}"""
{% endif %}
{%- if obj.variables or obj.outputs or obj.tasks or obj.global_variables %}
{%- for variable in obj.variables %}
{{variable | indent( width=4, first=True)}} #noqa
{%- endfor %}
{%- if obj.global_variables %}
    global_variables = [
        {%- for var in obj.global_variables %}
            Ref.GlobalVariable("{{ var }}"){{ ", " if not loop.last else "" }}
        {%- endfor %}
    ]
{% endif %}
{% if obj.outputs %}
    outputs=[
        {%- for output in obj.outputs %}
            {{output}},
        {%- endfor %}
    ]
{% endif %}
{%- for task in obj.tasks %}
{{task | indent( width=4, first=True)}}
{%- endfor %}
{% else %}
    pass
{%- endif %}

{% if obj.project_name %}
class RunbookMetadata(Metadata):
    project = Ref.Project('{{obj.project_name}}')
{%- endif %}

{%- endmacro %}

{{runbook(obj)}}
